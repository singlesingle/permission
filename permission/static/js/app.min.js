/*! AdminLTE app.js
 * ================
 * Main JS application file for AdminLTE v2. This file
 * should be included in all pages. It controls some layout
 * options and implements exclusive AdminLTE plugins.
 *
 * @Author  Almsaeed Studio
 * @Support <http://www.almsaeedstudio.com>
 * @Email   <support@almsaeedstudio.com>
 * @version 2.1.2
 * @license MIT <http://opensource.org/licenses/MIT>
 */
"use strict";
/**
 * CC.index.map;
 * *********/
!function(window){
    window.CC=window.CC||{};
    CC.index=CC.index||{};
    CC.index.map=function(data){
        var wapper=$('#host-area'),
            mapData,
            width=wapper.width(),
            height=wapper.height(),
            opts = {
                width     : width,
                height    : height,
                zoom      : 1.3,
                //x         : 55+(width)/2,
                //y         : 55+height/2,
                cityshow  : false,
                ifcity    : true,
                citystyle : 1,
                city_type: ['城市(标识A)'],
                loc_click : true,
                colorpanel: true,
                sHexColor : ['#A3B2ED','#7EC793','#6BCEF3'],
                sHexText  : [{'value':'0-100','text':'<100'},{'value':'100-1000','text':'100 ~ 1000'},{'value':'>1000','text':'>1000'}],
                set_per  : {'value':'per','text':'总数'},
                set_val  : {'IPNums':'主机数','IDCNums':'机房数','IDCName':'机房名称'},
                s_position_x    :   20,
                s_position_y    :   430,
                float_arr       :   {'width':140}
            };
        function initData(citys){
            var provinces=[],
                province_id,
                cityHash={},
                citydata={},
                city_id,
                data={};
            for(var i in $.fn.Rmap.citylistData){
                cityHash[$.fn.Rmap.citylistData[i].name]=i;
            }
            for(var i=0;i<citys.length;i++){
                city_id=cityHash[citys[i].city];
                province_id=city_id.substr(0,6);
                if(provinces[province_id]){
                    provinces[province_id]+=parseInt(citys[i].IPNums);
                }else{
                    provinces[province_id] = parseInt(citys[i].IPNums);
                }
                citydata[city_id]=citys[i];
            }
            for(var i in provinces){
                data[i]={per:provinces[i],AreaName:i}
            }
            data.city=citydata;
            return data;
        }
        mapData=initData(data);
        opts.datas=mapData;
        if($.fn.Rmap)return wapper.Rmap(opts);
    }
    CC.index.init=function(){
        var index=CC.index;
        index.initChart();
        index.hostArea=CC.index.map(CC.index.hostMap);
        index.optScroll();
    }
}(window)
/**
 * CC.index.initChart;
 * *********/
;CC.index.initChart=function(){
    function createChart() {
        var chostnumber = {
            title: {
                text: "",
                font:"20px 微软雅黑"
            },
            theme : 'metro',
            legend: {
                position: "bottom"
            },
            seriesDefaults: {
                type: "area",
                area: {}
            },
            series: [{
                name: "",
                data:CC.index.hostTrend.data
            }],
            valueAxis: {
                labels: {
                    format: "{0}",
                    font:"12px 微软雅黑"
                },
                line: {
                    visible: false
                },
                axisCrossingValue: -10
            },
            categoryAxis: {
                categories:CC.index.hostTrend.categories,
                majorGridLines: {
                    visible: false
                },
                labels: {
                    rotation: "auto",
                    font:"13px 微软雅黑"
                }
            },
            tooltip: {
                visible: true,
                format: "{0}%",
                shared : true,
                template: "#= value #",
                font:"13px 微软雅黑"
            }
        }
        var chostdate = {
            title: {
                text: "",
                font:"20px 微软雅黑"
            },
            legend: {
                position: "bottom"
            },
            theme : 'metro',
            seriesDefaults: {
                labels: {
                    template: "#= value #台-#= kendo.format('{0:P0}', percentage)#",
                    position: "insideEnd",
                    visible: true,
                    background: "transparent",
                    color:"#333333",
                    font:"13px 微软雅黑"
                }
            },
            series: [{
                type: "pie",
                data: CC.index.deadLineTime,
                padding: 0
            }],
            tooltip: {
                visible: true,
                font:"13px 微软雅黑",
                template: "#= category # - #= kendo.format('{0:P0}', percentage) #"
            }
        }

        $("#chostnumber").kendoChart(chostnumber);
        if (CC.index.deadLineTime.length){
            $("#chostdate").kendoChart(chostdate);
        }else{
            $("#chostdate").append("<h4 class='no-host'>目前尚没有主机</h4>");
        }

        var windowWidth = $(window).width();
        $(window).resize(function() {
            var _windowWidth = $(window).width();
            if (_windowWidth != windowWidth) {
                $("#chostnumber").kendoChart(chostnumber);
                if (CC.index.deadLineTime.length){
                    $("#chostdate").kendoChart(chostdate);
                }
                windowWidth = _windowWidth;
            };
        })
    }
    createChart();
    $(document).bind("kendo:skinChange", createChart);
}
/**
 * CC.index.optScroll;
 * *********/
;CC.index.optScroll=function (){
    function optScroll(){
        var $optHeight=0;
        for (var i = 0; i < 3; i++) {
            $optHeight+=$('.opt-item').eq(i).outerHeight();
        };
        $("#opt_box").mCustomScrollbar({
            setHeight:464, //设置高度
            theme:"minimal-dark" //设置风格
        });
    }
    optScroll();
    $(window).resize(function (){
        $("#opt_box").mCustomScrollbar("destroy");
        optScroll();
    })
}
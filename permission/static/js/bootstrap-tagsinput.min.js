(function(e){var c={tagClass:function(j){return"label label-info"},itemValue:function(j){return j?j.toString():j},itemText:function(j){return this.itemValue(j)},itemTitle:function(j){return null},freeInput:true,addOnBlur:true,maxTags:undefined,maxChars:undefined,confirmKeys:[13,44],delimiter:",",delimiterRegex:null,cancelConfirmKeysOnEmpty:true,onTagExists:function(k,j){j.hide().fadeIn()},trimValue:false,allowDuplicates:false};function h(j,k){this.itemsArray=[];this.$element=e(j);this.$element.hide();this.isSelect=(j.tagName==="SELECT");this.multiple=(this.isSelect&&j.hasAttribute("multiple"));this.objectItems=k&&k.itemValue;this.placeholderText=j.hasAttribute("placeholder")?this.$element.attr("placeholder"):"";this.inputSize=Math.max(1,this.placeholderText.length);this.$container=e('<div class="bootstrap-tagsinput"></div>');this.$input=e('<input type="text" placeholder="'+this.placeholderText+'"/>').appendTo(this.$container);this.$element.before(this.$container);this.build(k)}h.prototype={constructor:h,add:function(x,t,u){var w=this;if(w.options.maxTags&&w.itemsArray.length>=w.options.maxTags){return}if(x!==false&&!x){return}if(typeof x==="string"&&w.options.trimValue){x=e.trim(x)}if(typeof x==="object"&&!w.objectItems){throw ("Can't add objects when itemValue option is not set")}if(x.toString().match(/^\s*$/)){return}if(w.isSelect&&!w.multiple&&w.itemsArray.length>0){w.remove(w.itemsArray[0])}if(typeof x==="string"&&this.$element[0].tagName==="INPUT"){var s=(w.options.delimiterRegex)?w.options.delimiterRegex:w.options.delimiter;var r=x.split(s);if(r.length>1){for(var o=0;o<r.length;o++){this.add(r[o],true)}if(!t){w.pushVal()}return}}var m=w.options.itemValue(x),v=w.options.itemText(x),l=w.options.tagClass(x),k=w.options.itemTitle(x);var q=e.grep(w.itemsArray,function(z){return w.options.itemValue(z)===m})[0];if(q&&!w.options.allowDuplicates){if(w.options.onTagExists){var n=e(".tag",w.$container).filter(function(){return e(this).data("item")===q});w.options.onTagExists(x,n)}return}if(w.items().toString().length+x.length+1>w.options.maxInputLength){return}var y=e.Event("beforeItemAdd",{item:x,cancel:false,options:u});w.$element.trigger(y);if(y.cancel){return}w.itemsArray.push(x);var p=e('<span class="tag '+f(l)+(k!==null?('" title="'+k):"")+'">'+f(v)+'<span data-role="remove"></span></span>');p.data("item",x);w.findInputWrapper().before(p);p.after(" ");if(w.isSelect&&!e('option[value="'+encodeURIComponent(m)+'"]',w.$element)[0]){var j=e("<option selected>"+f(v)+"</option>");j.data("item",x);j.attr("value",m);w.$element.append(j)}if(!t){w.pushVal()}if(w.options.maxTags===w.itemsArray.length||w.items().toString().length===w.options.maxInputLength){w.$container.addClass("bootstrap-tagsinput-max")}w.$element.trigger(e.Event("itemAdded",{item:x,options:u}))},remove:function(l,m,k){var j=this;if(j.objectItems){if(typeof l==="object"){l=e.grep(j.itemsArray,function(o){return j.options.itemValue(o)==j.options.itemValue(l)})}else{l=e.grep(j.itemsArray,function(o){return j.options.itemValue(o)==l})}l=l[l.length-1]}if(l){var n=e.Event("beforeItemRemove",{item:l,cancel:false,options:k});j.$element.trigger(n);if(n.cancel){return}e(".tag",j.$container).filter(function(){return e(this).data("item")===l}).remove();e("option",j.$element).filter(function(){return e(this).data("item")===l}).remove();if(e.inArray(l,j.itemsArray)!==-1){j.itemsArray.splice(e.inArray(l,j.itemsArray),1)}}if(!m){j.pushVal()}if(j.options.maxTags>j.itemsArray.length){j.$container.removeClass("bootstrap-tagsinput-max")}j.$element.trigger(e.Event("itemRemoved",{item:l,options:k}))},removeAll:function(){var j=this;e(".tag",j.$container).remove();e("option",j.$element).remove();while(j.itemsArray.length>0){j.itemsArray.pop()}j.pushVal()},refresh:function(){var j=this;e(".tag",j.$container).each(function(){var m=e(this),n=m.data("item"),p=j.options.itemValue(n),l=j.options.itemText(n),o=j.options.tagClass(n);m.attr("class",null);m.addClass("tag "+f(o));m.contents().filter(function(){return this.nodeType==3})[0].nodeValue=f(l);if(j.isSelect){var k=e("option",j.$element).filter(function(){return e(this).data("item")===n});k.attr("value",p)}})},items:function(){return this.itemsArray},pushVal:function(){var j=this,k=e.map(j.items(),function(l){return j.options.itemValue(l).toString()});j.$element.val(k,true).trigger("change")},build:function(m){var k=this;k.options=e.extend({},c,m);if(k.objectItems){k.options.freeInput=false}d(k.options,"itemValue");d(k.options,"itemText");i(k.options,"tagClass");if(k.options.typeahead){var o=k.options.typeahead||{};i(o,"source");k.$input.typeahead(e.extend({},o,{source:function(r,t){function p(u){var w=[];for(var v=0;v<u.length;v++){var x=k.options.itemText(u[v]);s[x]=u[v];w.push(x)}t(w)}this.map={};var s=this.map,q=o.source(r);if(e.isFunction(q.success)){q.success(p)}else{if(e.isFunction(q.then)){q.then(p)}else{e.when(q).then(p)}}},updater:function(p){k.add(this.map[p]);return this.map[p]},matcher:function(p){return(p.toLowerCase().indexOf(this.query.trim().toLowerCase())!==-1)},sorter:function(p){return p.sort()},highlighter:function(q){var p=new RegExp("("+this.query+")","gi");return q.replace(p,"<strong>$1</strong>")}}))}if(k.options.typeaheadjs){var j=null;var n={};var l=k.options.typeaheadjs;if(e.isArray(l)){j=l[0];n=l[1]}else{n=l}k.$input.typeahead(j,n).on("typeahead:selected",e.proxy(function(q,p){if(n.valueKey){k.add(p[n.valueKey])}else{k.add(p)}k.$input.typeahead("val","")},k))}k.$container.on("click",e.proxy(function(p){if(!k.$element.attr("disabled")){k.$input.removeAttr("disabled")}k.$input.focus()},k));if(k.options.addOnBlur&&k.options.freeInput){k.$input.on("focusout",e.proxy(function(p){if(e(".typeahead, .twitter-typeahead",k.$container).length===0){k.add(k.$input.val());k.$input.val("")}},k))}k.$container.on("keydown","input",e.proxy(function(p){var u=e(p.target),t=k.findInputWrapper();if(k.$element.attr("disabled")){k.$input.attr("disabled","disabled");return}switch(p.which){case 8:if(a(u[0])===0){var q=t.prev();if(q.length){k.remove(q.data("item"))}}break;case 46:if(a(u[0])===0){var r=t.next();if(r.length){k.remove(r.data("item"))}}break;case 37:var v=t.prev();if(u.val().length===0&&v[0]){v.before(t);u.focus()}break;case 39:var s=t.next();if(u.val().length===0&&s[0]){s.after(t);u.focus()}break;default:}var y=u.val().length,w=Math.ceil(y/5),x=y+w+1;u.attr("size",Math.max(this.inputSize,u.val().length)+10)},k));k.$container.on("keypress","input",e.proxy(function(t){var v=e(t.target);if(k.$element.attr("disabled")){k.$input.attr("disabled","disabled");return}var u=v.val(),s=k.options.maxChars&&u.length>=k.options.maxChars;if(k.options.freeInput&&(b(t,k.options.confirmKeys)||s)){if(u.length!==0){k.add(s?u.substr(0,k.options.maxChars):u);v.val("")}if(k.options.cancelConfirmKeysOnEmpty===false){t.preventDefault()}}var r=v.val().length,q=Math.ceil(r/5),p=r+q+1;v.attr("size",Math.max(this.inputSize,v.val().length)+10)},k));k.$container.on("click","[data-role=remove]",e.proxy(function(p){if(k.$element.attr("disabled")){return}k.remove(e(p.target).closest(".tag").data("item"))},k));if(k.options.itemValue===c.itemValue){if(k.$element[0].tagName==="INPUT"){k.add(k.$element.val())}else{e("option",k.$element).each(function(){k.add(e(this).attr("value"),true)})}}},destroy:function(){var j=this;j.$container.off("keypress","input");j.$container.off("click","[role=remove]");j.$container.remove();j.$element.removeData("tagsinput");j.$element.show()},focus:function(){this.$input.focus()},input:function(){return this.$input},findInputWrapper:function(){var j=this.$input[0],k=this.$container[0];while(j&&j.parentNode!==k){j=j.parentNode}return e(j)}};e.fn.tagsinput=function(l,k,j){var m=[];this.each(function(){var n=e(this).data("tagsinput");if(!n){n=new h(this,l);e(this).data("tagsinput",n);m.push(n);if(this.tagName==="SELECT"){e("option",e(this)).attr("selected","selected")}e(this).val(e(this).val())}else{if(!l&&!k){m.push(n)}else{if(n[l]!==undefined){if(n[l].length===3&&j!==undefined){var o=n[l](k,null,j)}else{var o=n[l](k)}if(o!==undefined){m.push(o)}}}}});if(typeof l=="string"){return m.length>1?m:m[0]}else{return m}};e.fn.tagsinput.Constructor=h;function d(k,j){if(typeof k[j]!=="function"){var l=k[j];k[j]=function(m){return m[l]}}}function i(k,j){if(typeof k[j]!=="function"){var l=k[j];k[j]=function(){return l}}}var g=e("<div />");function f(j){if(j){return g.text(j).html()}else{return""}}function a(k){var l=0;if(document.selection){k.focus();var j=document.selection.createRange();j.moveStart("character",-k.value.length);l=j.text.length}else{if(k.selectionStart||k.selectionStart=="0"){l=k.selectionStart}}return(l)}function b(j,l){var k=false;e.each(l,function(o,n){if(typeof(n)==="number"&&j.which===n){k=true;return false}if(j.which===n.which){var q=!n.hasOwnProperty("altKey")||j.altKey===n.altKey,m=!n.hasOwnProperty("shiftKey")||j.shiftKey===n.shiftKey,p=!n.hasOwnProperty("ctrlKey")||j.ctrlKey===n.ctrlKey;if(q&&m&&p){k=true;return false}}});return k}e(function(){e("input[data-role=tagsinput], select[multiple][data-role=tagsinput]").tagsinput()})})(window.jQuery);